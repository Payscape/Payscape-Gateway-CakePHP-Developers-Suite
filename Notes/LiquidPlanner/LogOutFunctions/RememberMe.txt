 'm trying to set it up so when a user logs in there's a remember me checkbox which if checked writes a cookie to as to remember the email and password of the user. Like this in my user controller login function:

public function login() {
    if (!empty($this->data)) {
        if ($this->Auth->login()) {
            $userId = $this->Auth->user('id');
            if(!empty($this->data['User']['remember'])) {
                $user = $this->User->find('first', array('conditions'=>array('id'=>$userId), 'recursive'=>-1, 'fields'=>array('email', 'password')));
                $this->Cookie->write('User', $user['User']);
            }
... etc etc ...
In cakephp 1.x I had this working so in my AppController's beforefilter I would simply look for the cookie and try to login like this:

//try to auto login a users
    if($this->Auth->user() == null) {
        $user = $this->Cookie->read('User');
        if(!empty($user)) {
            $this->Auth->login($user);
        }
    }
But that doesn't seem to work now. I think because from what I read if you pass anything to the login function it will return true. Rather to login correctly I'd need to POST the contents of that cookie to login function...

Is that right? Is there an easier way than trying to create a form somewhere and via lots of redirects have it post the info?

I also tried adding the the cookie info into the $this->request->data array and attemping to login but that didn't work either :(

//try to auto login a users
if($this->Auth->user() == null) {
    $user = $this->Cookie->read('User');
        if(!empty($user)) {
            $this->request->data['User']['email'] = $user['email'];
            $this->request->data['User']['password'] = $user['password'];
            $this->Auth->login();
        }
    }
Can anyone help me out? There's gotta be an easier way to do this!

php cakephp
share|improve this question
asked Mar 27 at 17:28

Patrick Guinness
1005
By the way I should point out. I'm a bit new to cakephp and Also I have googled and searched stackoverflow but I can't find any decent tutorials that deal with cakephp2.x and from what I read there's a big difference – Patrick Guinness Mar 27 at 17:45
I hope you do not store raw password in your cookie... – icebreaker Mar 28 at 14:04
1 Answer
activeoldestvotes
up vote
0
down vote
Try this..

Keep this checkbox in the login ctp file

 <php echo $this->Form->checkbox('remember_me',array("id" => "id_remember_me",'name'=>'remember_me','label' => false)); ?>
 <span onclick="$('#id_remember_me').attr('checked',true);"><?php echo __('Remember my details')?></span>
then after keep this

code in the controller where the $this->Auth->login() is..
     //Setting up the expiry time
     $year = time() + 31536000;
     if($this->request->data['remember_me']) {
     // Creating a cookie in the name of remember_me with the username for the time which was set
          setcookie('remember_me', $this->request->data['User']['username'], $year);
     }
     else if(!$this->request->data['remember_me']) {
         if(isset($_COOKIE['remember_me'])) {
              $past = time() - 100;
              setcookie('remember_me', 'gone', $past);
         }
     }
share|improve this answer
answered Apr 6 at 7:17